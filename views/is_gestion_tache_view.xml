<?xml version="1.0" encoding="utf-8"?>

<odoo>
    <data>

        <!-- is.gestion.tache.planning -->
        <record model="ir.ui.view" id="is_gestion_tache_planning_form_view">
            <field name="name">is_gestion_tache_planning_form_view</field>
            <field name="model">is.gestion.tache.planning</field>
            <field name="type">form</field>
            <field name="arch" type="xml">
                <form>
                    <header>
                        <button name="action_chargement_taches" type="object" string="Charger les tâches" class="oe_highlight" attrs="{'invisible': [('tache_count','>',0)]}"/>
                        <button name="action_maj_fermetures" type="object" string="Maj fermetures"/>
                        <button 
                            name="action_maj_date_of" type="object" string="Maj date OF" 
                            confirm="ATTENTION, cela va changer la date prévue de tous les OF concernés et également l'heure de début de toutes les opérations de ces OF"
                        />
                        <button 
                            name="action_maj_date_operation" type="object" string="Maj date opération" 
                            attrs="{'invisible':[('type_donnees','!=','operation')]}"
                            confirm="ATTENTION, cela va changer l'heure de début prévue des opérations concernées et également l'heure de début des opérations suivantes des OF"
                        />
                        <button name="action_open_productions"     type="object" string="Voir les OF" class="oe_link"/>
                        <button name="action_open_operation_lines" type="object" string="Voir les lignes d'opérations" class="oe_link" attrs="{'invisible':[('type_donnees','!=','operation')]}"/>
                        <button name="action_open_taches"          type="object" string="Voir les tâches" class="oe_link"/>
                        <button name="action_open_fermetures"      type="object" string="Voir les fermetures" class="oe_link"/>
                    </header>
                    <sheet>
                        <group>
                            <group>
                                <field name="name"/> 
                                <field name="date_fin_planning"/>
                                <field name="tache_count"/> 
                            </group>
                            <group>
                                <field name="type_donnees" required="1"/>
                                <field name="workcenter_id" attrs="{'invisible':[('type_donnees','!=','operation')], 'required':[('type_donnees','==','operation')]}"/>
                                <field name="affaire"/>
                                <field name="is_pret"/>

                            </group>
                        </group>
                        <notebook>
                            <page string="Affaires">
                                <field name="affaire_ids" readonly="1">
                                    <tree>
                                        <field name="name"/>
                                        <field name="order_id" widget="many2one_clickable"/>
                                        <field name="color" widget="color"/>
                                    </tree>
                                </field>
                            </page>
                            <page string="Opérateurs" attrs="{'invisible': [('type_donnees','!=','operation')]}">
                                <field name="operateur_ids" readonly="1">
                                    <tree>
                                        <field name="operator_id"/>
                                    </tree>
                                </field>
                            </page>
                            <page string="Postes de charge" attrs="{'invisible': [('type_donnees','!=','of')]}">
                                <field name="workcenter_ids" readonly="1">
                                    <tree>
                                        <field name="workcenter_id" widget="many2one_clickable"/>
                                    </tree>
                                </field>
                            </page>
                        </notebook>
                    </sheet>
                </form>
            </field>
        </record>

        <record model="ir.ui.view" id="is_gestion_tache_planning_tree_view">
            <field name="name">is_gestion_tache_planning_tree_view</field>
            <field name="model">is.gestion.tache.planning</field>
            <field name="type">tree</field>
            <field name="arch" type="xml">
                <tree>
                    <field name="name"/>
                    <field name="type_donnees"/>
                    <field name="workcenter_id"/>
                    <field name="affaire"/>
                    <field name="is_pret"/>
                    <field name="date_fin_planning" optional="show"/>
                    <field name="tache_count"/>
                </tree>
            </field>
        </record>

        <record model="ir.ui.view" id="is_gestion_tache_planning_search_view">
            <field name="name">is_gestion_tache_planning_search_view</field>
            <field name="model">is.gestion.tache.planning</field>
            <field name="arch" type="xml">
                <search>
                    <field name="name"/>
                </search>
            </field>
        </record>

        <record model="ir.actions.act_window" id="is_gestion_tache_planning_action">
            <field name="name">Plannings</field>
            <field name="res_model">is.gestion.tache.planning</field>
            <field name="view_mode">tree,form</field>
        </record>



        <!-- is.gestion.tache.affaire -->
        <record model="ir.ui.view" id="is_gestion_tache_affaire_form_view">
            <field name="name">is_gestion_tache_affaire_form_view</field>
            <field name="model">is.gestion.tache.affaire</field>
            <field name="type">form</field>
            <field name="arch" type="xml">
                <form>  
                    <sheet>
                        <group>
                            <field name="name"/> 
                            <field name="color" widget="color"/>
                            <field name="planning_id"/>
                        </group>
                    </sheet>
                </form>
            </field>
        </record>

        <record model="ir.ui.view" id="is_gestion_tache_affaire_tree_view">
            <field name="name">is_gestion_tache_affaire_tree_view</field>
            <field name="model">is.gestion.tache.affaire</field>
            <field name="type">tree</field>
            <field name="arch" type="xml">
                <tree>
                    <field name="name"/>
                    <field name="color" widget="color"/>
                    <field name="planning_id"/>
                </tree>
            </field>
        </record>

        <record model="ir.ui.view" id="is_gestion_tache_affaire_search_view">
            <field name="name">is_gestion_tache_affaire_search_view</field>
            <field name="model">is.gestion.tache.affaire</field>
            <field name="arch" type="xml">
                <search>
                    <field name="name"/>
                </search>
            </field>
        </record>

        <record model="ir.actions.act_window" id="is_gestion_tache_affaire_action">
            <field name="name">Affaires</field>
            <field name="res_model">is.gestion.tache.affaire</field>
            <field name="view_mode">tree,form</field>
        </record>

        <!-- is.gestion.tache -->
        <record model="ir.ui.view" id="is_gestion_tache_form_view">
            <field name="name">is_gestion_tache_form_view</field>
            <field name="model">is.gestion.tache</field>
            <field name="type">form</field>
            <field name="arch" type="xml">
                <form>  
                    <sheet>
                        <group>
                            <group>
                                <field name="name"/> 
                                <field name="operator_id"/>
                                <field name="workcenter_id"/>
                                <field name="affaire_id"/>
                                <field name="start_date"/>
                                <field name="duration_hours"/>
                            </group>
                            <group>
                                <field name="order_id"/>
                                <field name="production_id"/>
                                <field name="ordre_travail_id"/>
                                <field name="operation_id"/>
                            </group>
                        </group>
                    </sheet>
                </form>
            </field>
        </record>
        <record model="ir.ui.view" id="is_gestion_tache_tree_view">
            <field name="name">is_gestion_tache_tree_view</field>
            <field name="model">is.gestion.tache</field>
            <field name="type">tree</field>
            <field name="arch" type="xml">
                <tree>
                    <field name="name"/>
                    <field name="operator_id" optional="show"/>
                    <field name="workcenter_id" optional="show"/>
                    <field name="affaire_id" optional="show"/>
                    <field name="start_date" optional="show"/>
                    <field name="duration_hours" optional="show"/>
                    <field name="planning_id" optional="show"/>
                    <field name="order_id" optional="show" widget="many2one_clickable"/>
                    <field name="production_id" optional="show" widget="many2one_clickable"/>
                    <field name="ordre_travail_id" optional="show" widget="many2one_clickable"/>
                    <field name="operation_id" optional="show" widget="many2one_clickable"/>
                </tree>
            </field>
        </record>

        <record model="ir.ui.view" id="is_gestion_tache_search_view">
            <field name="name">is_gestion_tache_search_view</field>
            <field name="model">is.gestion.tache</field>
            <field name="arch" type="xml">
                <search>
                    <field name="name"/>
                    <field name="operator_id"/>
                    <field name="workcenter_id"/>
                    <field name="affaire_id"/>
                    <field name="start_date"/>
                    <separator/>
                    <group expand="0" string="Grouper par">
                        <filter string="Opérateur" name="group_operator" context="{'group_by': 'operator_id'}"/>
                        <filter string="Affaire" name="group_affaire" context="{'group_by': 'affaire_id'}"/>
                        <filter string="Date de début" name="group_start_date" context="{'group_by': 'start_date:month'}"/>
                    </group>
                </search>
            </field>
        </record>

        <record model="ir.actions.act_window" id="is_gestion_tache_action">
            <field name="name">Gestion des Tâches</field>
            <field name="res_model">is.gestion.tache</field>
            <field name="view_mode">tree,form</field>
        </record>


        <!-- is.gestion.tache.fermeture -->
        <record model="ir.ui.view" id="is_gestion_tache_fermeture_tree_view">
            <field name="name">is_gestion_tache_fermeture_tree_view</field>
            <field name="model">is.gestion.tache.fermeture</field>
            <field name="arch" type="xml">
                <tree>
                    <field name="date_fermeture"/>
                    <field name="operator_id" widget="many2one_clickable"/>
                    <field name="intitule"/>
                    <field name="planning_id" widget="many2one_clickable"/>
                </tree>
            </field>
        </record>

        <record model="ir.ui.view" id="is_gestion_tache_fermeture_form_view">
            <field name="name">is_gestion_tache_fermeture_form_view</field>
            <field name="model">is.gestion.tache.fermeture</field>
            <field name="arch" type="xml">
                <form>
                    <sheet>
                        <group>
                            <field name="date_fermeture"/>
                            <field name="operator_id"/>
                            <field name="intitule"/>
                        </group>
                    </sheet>
                </form>
            </field>
        </record>

        <record model="ir.ui.view" id="is_gestion_tache_fermeture_search_view">
            <field name="name">is_gestion_tache_fermeture_search_view</field>
            <field name="model">is.gestion.tache.fermeture</field>
            <field name="arch" type="xml">
                <search>
                    <field name="date_fermeture"/>
                    <field name="operator_id"/>
                    <field name="intitule"/>
                    <separator/>
                    <group expand="0" string="Grouper par">
                        <filter string="Date" name="group_date" context="{'group_by':'date_fermeture'}"/>
                        <filter string="Opérateur" name="group_operator" context="{'group_by':'operator_id'}"/>
                    </group>
                </search>
            </field>
        </record>

        <!-- Action pour ouvrir l'application Flask -->
        <record model="ir.actions.server" id="is_gestion_tache_flask_action">
            <field name="name">Application Flask</field>
            <field name="model_id" ref="model_is_gestion_tache_planning"/>
            <field name="state">code</field>
            <field name="code">
# Récupérer l'URL depuis le champ de la société
company = env.user.company_id
flask_url = company.is_url_app_flask or 'http://localhost:5000'

action = {
    'type': 'ir.actions.act_url',
    'url': flask_url,
    'target': 'new',
}
            </field>
        </record>

        <!-- Menus -->
        <menuitem id="is_gestion_tache_menu_root" 
                  name="Gestion de tâches" 
                  sequence="86"/>

        <menuitem id="is_gestion_tache_planning_menu" 
                  name="Plannings" 
                  parent="is_gestion_tache_menu_root" 
                  action="is_gestion_tache_planning_action" 
                  sequence="10"/>

         <menuitem id="is_gestion_tache_menu" 
                  name="Tâches" 
                  parent="is_gestion_tache_menu_root" 
                  action="is_gestion_tache_action" 
                  sequence="20"/>

        <menuitem id="is_gestion_tache_affaire_menu" 
                  name="Affaires" 
                  parent="is_gestion_tache_menu_root" 
                  action="is_gestion_tache_affaire_action" 
                  sequence="30"/>


       <menuitem id="is_gestion_tache_flask_menu" 
                  name="Gestion de tâches" 
                  parent="is_gestion_tache_menu_root" 
                  action="is_gestion_tache_flask_action" 
                  sequence="40"/>




    </data>
</odoo>
